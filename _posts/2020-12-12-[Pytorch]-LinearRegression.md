---
layout: post
title: "[Pytorch] - 선형회귀(Linear Regression)"
date: 2020-12-12 15:00:00
category: Pytorch
use_math: true
---

이전 포스터에서는 Tensor와 Autograd등에 대해 알아보았다. 이번 포스터에서는 Pytorch을 이용해 간단한 연산을 하는 방법에 대해 알아보고 선형회귀를 코드로 구현을 해서 어떤 원리가 적용되고 있는지, 또한 실제로 간단한 데이터를 생성하여 모델을 학습시켜 데이터에 맞는 적절한 모델을 찾는 실습을 해보기로 하자. 

# 선형 회귀(Linear Regression)
<hr>

일반적으로 사람 키와 몸무게는 서로 상관관계가 있다. 보통 키가 크면 몸무게도 많이 나갈 수 밖에 없다는 것을 잘 알고 있다. 물론 모든 사람에게 똑같이 적용되진 않지만, 선형회귀를 이해하기 위해 키와 몸무게의 관계가 비례관계에 있다고 가정을 해보자!
<br>

| 몸무게(kg)  | 키(cm) |
|----------|--------|
| 83 | 180 |
| 93 | 190 |
| 78 | 175 |
| 69 | 166 |
| 56 | 153 |

<br>

위 데이터를 통해 간단한 식을 설정하면 다음과 같다.

$$ 몸무게(kg) = \theta_1\cdot 키(cm) + \theta_0$$

이 모델은 입력 특성인 **키(cm)** 에 대한 선형 함수이고 $\theta_0$과 $\theta_1$은 모델의 파라미터이다. 이처럼 키와 몸무게로 얻은 관계식을 '선형회귀모델'이라고 부른다. 이 식을 일반화하면 다음과 같다.

$$ y = \theta_0x_0 + \theta_1x_1  + \theta_2x_2  +\cdot\cdot\cdot\text{ }+ \theta_nx_n $$

위 식에서 $x_n$은 독립변수이며 $\theta_n$은 각 독립변수의 계수, $y$는 종속변수를 의미한다. 쉽게 x가 데이터(키)가 되고, y는 그에 따른 예측값(몸무게)가 되는 것이다. 이 식이 선형 회귀라고 불리는 이유는 종속변수가 독립변수에 대해 선형 함수(1차 함수)의 관계가 있을 것이라고 가정하기 때문이다.
- $x$는 독립변수 이외에 입력변수, 예측 변수, 독립 변수 등으로 불린다.
- $y$는 종속변수 이외에 응답변수라고도 불린다.
- $n$은 특성의 수로 독립변수의 종류를 뜻한다.(데이터의 개수와는 다른 의미이다.)
<br>

<img  src="/public/img/pytorch/regression.png" width="400" style='margin: 0px auto;'/>
<br>

선형회귀모델에서는 몇 가지 가정을 한다. 모든 예측모델이 그렇듯이 모든 경우의 수를 전부 적용하지 못하기 때문에 몇 가지 가정을 두고 예측을 실시한다. 선형회귀모델에서의 가정은 다음과 같다.

- **약한 외생성** : 독립변수 $x$가 확률변수가 아니라 고정된 값으로 취급한다는 것이다. 독립변수에는 에러가 없다는 것을 의미하고 측정 오차로 인해 오염되지 않았음을 가정하는 것과 같다.<br>
(현실적이진 않다.)
- **선형성** : 종속변수가 독립변수와 각 계수들의 선형 조합으로 표현이 가능함을 의미한다.
- **상수 분산** : 서로 다른 독립변수들의 오차가 독립변수와 무관하게 항상 같은 분산을 가지는 것을 의미한다. 
- **오차의 독립성** : 독립변수의 오차가 서로 무관함을 가정한다는 의미이다.

<br>
선형 회귀에도 다양한 종류가 있지만, 크게 '단순 선형'과 '다중 선형'으로 나뉜다.

### 단순 선형 회귀
<br>

위에 언급한 '키와 몸무게'의 관계가 바로 단순선형회귀이다. 한 개의 스칼라 독립변수(키)와 한 개의 스칼라 종속변수(몸무게)의 관계를 말한다. 흔히 알고 있는 1차 함수의 직선이 '회귀선(Reagression Line)'이라고 부르고 다른 말로는 '단순선형회귀모델'이라고 부른다. 따라서 위에 일반 식에서 단순 선형 회귀는 다음과 같아진다.

$$ y = \theta_1\cdot x + \theta_0$$

위에서 $n$을 독립변수의 종류라고 표현을 했는데, 단순선형회귀모델에서는 독립변수의 종류가 1개 뿐인 회귀모델이다. 그리고 $n=0$인  $x_0$를 표시하지 않았는데, 이것은 단순히 일반화로 표현하기 위해 표시를 했을 뿐, 실제로는 $x_0=1$이기에 생략을 할 수 있다.

### 다중 선형 회귀(Multiple Linear Regression)
<br>

이름에서도 알 수 있듯이 독립변수가 2개 이상인 것을 '다중선형회귀'라고 한다. 보통 실제 세상에는 단순선형 보다는 대부분이 다중선형의 관계를 띄는 경우가 대부분이다. 이 모형에 포함되는 독립변수들을 공변량이라고 하며 각 계수들을 편회귀 계수라고 칭한다.
- 각각의 독립변수가 종속변수에 얼마나 영향을 미치는지 파악할 수 있다

<br>

| 방문객(명)   | 서비스(점수) | 가격(점수) | 접근성(점수) | 인테리어(점수) | 추천수(개수) |
|----------|--------|---------|---------|---------|---------|
| 5071 |  83 |50|70|50|70|
| 1030 |  93 |10|20|50|100|
| 7506 |  78 |71|81|66|12|
| 5000 |  69 |56|70|36|72|
| 1200 |  56 |55|97|12|120|
|$\cdot\cdot\cdot$|$\cdot\cdot\cdot$|$\cdot\cdot\cdot$|$\cdot\cdot\cdot$|$\cdot\cdot\cdot$|$\cdot\cdot\cdot$

<br>


위 데이터를 토대로 만든 다중선형회귀 모델은 다음과 같다.
$$
\hat{y} = \theta_0 + \theta_1서비스 + \theta_2가격 + \theta_3접근성 + \theta_4인테리어 + \theta_5추천수
$$

데이터를 이용하여 해당 모델을 예측하여 각 독립변수들에 대한 계수들의 수치를 알면 방문객 수에 가장 많은 영향을 주는 요소가 무엇인지 알 수 있다. 이러한 상관관계 분석을 하는데 있어서 매우 유용한 기법인 것 같다!
<br>

# 코드 실습
<hr>

Pytorch에는 선형회귀를 쉽고 빠르게 할 수 있도록 모듈을 제공해준다. 밑바닥부터 코딩하기 전에 이미 제공하고 있는 모듈을 이용하여 실습을 진행해보자.

<br>

주위에 있던 친구들에게서 데이터를 수집했다. 4명 정도에게서 얻은 데이터는 다음과 같다.
<br>

|Index| 몸무게(kg) | 키(cm) |
|-------|------------|-------|
|A|72          |174    |
|B|76          |180    |
|C|65          |169    |
|D|171         |68     |

<br>

위 데이터를 이용하면 $\theta$값을 구할 수 있다.

<br>

$$ y = \theta_1x + \theta_0 $$

<br>

선형회귀모델에서 손실함수를 최소화하는 $\theta$값을 구하는 방법인 '정규방정식'이 있다. 하지만 이 방정식을 이용하기 전에 간단하게 1차함수를 구하는 방법으로 $\theta$값을 구해보자.<br>

$$ y = \theta_1x + \theta_0 =  \frac{\partial y}{\partial x}x + y_0 $$

<br>

$$
\frac{\partial y}{\partial x} = \frac{y_2 - y_1}{x_2 - x_1} = \frac{76 - 72}{180 - 174} = \frac{4}{6} \approx 0.6666
$$

<br>

$$ y_1 = 0.6666x_1 + y_0 $$



<br>
<br><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br><br>
<br><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br><br>
<br><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br><br>
<br><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br><br>
<br><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br><br>
<br><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>


<br>
이번 포스터에서는 선형회귀모델에 대해 알아보았다. 앞으로도 계속 다양한 모델들에 대해 다루겠지만, 가장 기본이 되고 세상에서 발생하는 여러 현상들을 설명하는데 많은 사용이 되고 있는 모델이기 때문에 자세히 알아놓으면 매우 좋을 것 같다.

### **읽어주셔서 감사합니다.(댓글과 수정사항은 언제나 환영입니다!)**